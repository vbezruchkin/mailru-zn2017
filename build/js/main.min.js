"use strict";function drawClock(e){var t=[(e=e?new Date(e):new Date).getHours()>9?e.getHours():"0"+e.getHours(),e.getMinutes()>9?e.getMinutes():"0"+e.getMinutes(),e.getSeconds()>9?e.getSeconds():"0"+e.getSeconds()].join(":");document.getElementById("clock").innerHTML=t}function timerAction(e,t){"freeze"===e?(clearTimeout(clockInterval),drawClock(t)):clockInterval=setInterval(function(){drawClock(new Date)},1e3)}function initKey(e){for(var t=new ArrayBuffer(16),n=new DataView(t),o=0;o<16;++o)n.setInt8(1,secret_key.charCodeAt(o));return t}function getMagic(e,t){e=Math.floor(e/1e3),window.crypto.subtle.importKey("raw",initKey(secret_key),{name:"AES-CBC"},!1,["encrypt"]).then(function(n){var o=new ArrayBuffer(16);new DataView(o).setInt32(1,cnt),window.crypto.subtle.encrypt({name:"AES-CBC",iv:o},n,enc.encode(Math.floor((e+1)/3).toString())).then(function(n){new DataView(n).getInt32(1)%10?t(e,0):t(e,Math.floor(8*Math.random())+1),cnt+=1})})}function playSound(e){window.sound=document.getElementById(e),window.sound.play()}var clockInterval;$(function(){function e(e,t,n){this.speed=0,this.step=n,this.si=null,this.el=e,this.maxSpeed=t,this.pos=null,$(e).pan({fps:50,dir:"down"}),$(e).spStop()}function t(){m.removeClass("clicked"),u=0}function n(){m.addClass("clicked"),u=1}function o(){l[S.pos]===l[b.pos]&&l[S.pos]===l[C.pos]&&l[S.pos]===l[x.pos]&&l[S.pos]===l[I.pos]?i("win",1.5,function(){i("start",600)}):i("try",1.5,function(){i("start",600)})}function s(){var e;S.stop(),b.stop(),C.stop(),x.stop(),I.stop(),e=setInterval(function(){0===S.speed&&0===b.speed&&0===C.speed&&0===x.speed&&0===I.speed&&5===d&&(clearInterval(e),setTimeout(a,100))},100)}function i(e,t,n){"game"==e&&(m.addClass("clicked"),k=setTimeout(function(){$(".mg-main").addClass("mg-main_game"),g.hide(),w.hide(),$("#logo").hide(),$("#slots, #clock").show(),n&&n()},1e3*t)),"win"==e&&(timerAction(),k=setTimeout(function(){playSound("win"),g.show(),y.show(),n&&n()},1e3*t)),"try"==e&&(timerAction(),k=setTimeout(function(){playSound("loose"),y.hide(),g.show(),h.show(),n&&n()},1e3*t)),"start"==e&&(k=setTimeout(function(){$(".mg-main").removeClass("mg-main_game"),g.hide(),w.show(),$("#slots, #clock").hide(),y.hide(),$("#logo").show()},1e3*t))}function a(){o(),S.reset(),b.reset(),C.reset(),x.reset(),I.reset(),t()}function r(){if(!m.hasClass("clicked")){n(),clearTimeout(k);var e,t;timerAction("freeze",v=Date.now()),i("game",1.2,function(){playSound("start"),getMagic(v,function(e,t){f=t,console.log(f)}),S.start(),b.start(),C.start(),x.start(),I.start(),e=setInterval(function(){S.speed>=S.maxSpeed&&b.speed>=b.maxSpeed&&C.speed>=C.maxSpeed&&x.speed>=x.maxSpeed&&I.speed>=I.maxSpeed&&(clearInterval(e),t=Math.floor(200*Math.random()),setTimeout(s,100+t))},50)})}}var c,d=0,p=[],u=0,l=[];for(c=0;c<24;c++)p.push(185*c);p.forEach(function(e,t){l[e]=t%8+1});var f=0,m=$(".js-control"),g=$(".mg-overlay"),w=$(".mg-button_start"),h=$(".mg-button_tryagain"),y=$(".mg-button_win");e.prototype.start=function(){var e=this;$(e.el).addClass("motion"),$(e.el).spStart(),e.si=window.setInterval(function(){e.speed<e.maxSpeed&&(e.speed+=e.step,$(e.el).spSpeed(e.speed))},100)},e.prototype.stop=function(){var e=this;clearInterval(e.si),e.si=window.setInterval(function(){e.speed>30&&(e.speed-=e.step,$(e.el).spSpeed(e.speed)),e.speed<=30&&(e.finalPos(e.el),$(e.el).spSpeed(0),$(e.el).spStop(),clearInterval(e.si),$(e.el).removeClass("motion"),e.speed=0)},100)},e.prototype.finalPos=function(){var e,t,n=this,o=n.el;t=8+(f?f-1:Math.floor(8*Math.random())),n.pos=p[t],e="32px "+(p[t]+81)+"px",$(o).animate({backgroundPosition:"("+e+")"},{duration:150,complete:function(){playSound("stop"),d++}})},e.prototype.reset=function(){var e=this,t=$(e.el).attr("id");$._spritely.instances[t].t=0,e.speed=0,d=0};var k,v,S=new e("#slot1",30,1),b=new e("#slot2",55,1.5),C=new e("#slot3",85,2),x=new e("#slot4",115,2.5),I=new e("#slot5",150,3);m.click(r),$(document).keydown(function(e){"32"!=e.keyCode&&"13"!=e.keyCode&&"83"!=e.keyCode||r()})}),$(function(){function e(e){var t=(e=(e=(e=e.replace(/left|top/g,"0px")).replace(/right|bottom/g,"100%")).replace(/([0-9\.]+)(\s|\)|$)/g,"$1px$2")).match(/(-?[0-9\.]+)(px|\%|em|pt)\s(-?[0-9\.]+)(px|\%|em|pt)/);return[parseFloat(t[1],10),t[2],parseFloat(t[3],10),t[4]]}if(!document.defaultView||!document.defaultView.getComputedStyle){var t=$.css;$.css=function(e,n,o){if("background-position"===n&&(n="backgroundPosition"),"backgroundPosition"!==n||!e.currentStyle||e.currentStyle[n])return t.apply(this,arguments);var s=e.style;return!o&&s&&s[n]?s[n]:t(e,"backgroundPositionX",o)+" "+t(e,"backgroundPositionY",o)}}var n=$.fn.animate;$.fn.animate=function(e){return"background-position"in e&&(e.backgroundPosition=e["background-position"],delete e["background-position"]),"backgroundPosition"in e&&(e.backgroundPosition="("+e.backgroundPosition),n.apply(this,arguments)},$.fx.step.backgroundPosition=function(t){if(!t.bgPosReady){var n=$.css(t.elem,"backgroundPosition");n||(n="0px 0px"),n=e(n),t.start=[n[0],n[2]];var o=e(t.end);t.end=[o[0],o[2]],t.unit=[o[1],o[3]],t.bgPosReady=!0}var s=[];s[0]=(t.end[0]-t.start[0])*t.pos+t.start[0]+t.unit[0],s[1]=(t.end[1]-t.start[1])*t.pos+t.start[1]+t.unit[1],t.elem.style.backgroundPosition=s[0]+" "+s[1]}});var enc=new TextEncoder("utf-8"),secret_key="XXXXXXXXXXXXXXXX",cnt=0;